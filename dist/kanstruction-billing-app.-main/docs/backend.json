
{
  "entities": {
    "ProductCategory": {
      "$schema": "http://json-schema.org/draft-07/schema#",
      "title": "ProductCategory",
      "type": "object",
      "description": "Represents a category of products, such as Cement, Steel, or Hardware.",
      "properties": {
        "id": {
          "type": "string",
          "description": "Unique identifier for the product category."
        },
        "name": {
          "type": "string",
          "description": "Name of the product category (e.g., Cement, Steel)."
        }
      },
      "required": [
        "id",
        "name"
      ]
    },
    "Product": {
      "$schema": "http://json-schema.org/draft-07/schema#",
      "title": "Product",
      "type": "object",
      "description": "Represents a specific product within a category.",
      "properties": {
        "id": {
          "type": "string",
          "description": "Unique identifier for the product."
        },
        "categoryId": {
          "type": "string",
          "description": "Reference to ProductCategory. (Relationship: ProductCategory 1:N Product)"
        },
        "name": {
          "type": "string",
          "description": "Name of the product (e.g., UltraTech Cement, TMT Bars)."
        }
      },
      "required": [
        "id",
        "categoryId",
        "name"
      ]
    },
    "Invoice": {
      "$schema": "http://json-schema.org/draft-07/schema#",
      "title": "Invoice",
      "type": "object",
      "description": "Represents an invoice generated by the application.",
      "properties": {
        "id": {
          "type": "string",
          "description": "Unique identifier for the invoice."
        },
        "businessName": {
          "type": "string",
          "description": "Name of the business issuing the invoice.",
          "format": "string"
        },
        "ownerName": {
          "type": "string",
          "description": "Name of the owner of the business.",
          "format": "string"
        },
        "gstin": {
          "type": "string",
          "description": "GSTIN of the business (optional).",
          "format": "string"
        },
        "invoiceDate": {
          "type": "string",
          "description": "Date the invoice was created.",
          "format": "date-time"
        }
      },
      "required": [
        "id",
        "invoiceDate"
      ]
    },
    "InvoiceItem": {
      "$schema": "http://json-schema.org/draft-07/schema#",
      "title": "InvoiceItem",
      "type": "object",
      "description": "Represents a single item within an invoice.",
      "properties": {
        "id": {
          "type": "string",
          "description": "Unique identifier for the invoice item."
        },
        "invoiceId": {
          "type": "string",
          "description": "Reference to Invoice. (Relationship: Invoice 1:N InvoiceItem)"
        },
        "productId": {
          "type": "string",
          "description": "Reference to Product. (Relationship: Product 1:N InvoiceItem)"
        },
        "quantity": {
          "type": "number",
          "description": "Quantity of the product in this invoice item."
        },
        "unitPrice": {
          "type": "number",
          "description": "Unit price of the product."
        },
        "gstRate": {
          "type": "number",
          "description": "GST rate applied to this item (e.g., 0, 5, 12, 18, 28)."
        }
      },
      "required": [
        "id",
        "invoiceId",
        "productId",
        "quantity",
        "unitPrice",
        "gstRate"
      ]
    }
  },
  "auth": {
    "providers": [
      "password",
      "anonymous",
      "google.com",
      "phone"
    ]
  },
  "firestore": {
    "structure": [
      {
        "path": "/product_categories/{productCategoryId}",
        "definition": {
          "entityName": "ProductCategory",
          "schema": {
            "$ref": "#/backend/entities/ProductCategory"
          },
          "description": "Stores product categories.  `productCategoryId` is the unique identifier.",
          "params": [
            {
              "name": "productCategoryId",
              "description": "The unique identifier of the product category."
            }
          ]
        }
      },
      {
        "path": "/products/{productId}",
        "definition": {
          "entityName": "Product",
          "schema": {
            "$ref": "#/backend/entities/Product"
          },
          "description": "Stores products.  `productId` is the unique identifier.",
          "params": [
            {
              "name": "productId",
              "description": "The unique identifier of the product."
            }
          ]
        }
      },
      {
        "path": "/users/{userId}/invoices/{invoiceId}",
        "definition": {
          "entityName": "Invoice",
          "schema": {
            "$ref": "#/backend/entities/Invoice"
          },
          "description": "Stores invoices created by the user. `userId` is the user's UID, and `invoiceId` is the invoice's unique identifier.",
          "params": [
            {
              "name": "userId",
              "description": "The unique identifier of the user."
            },
            {
              "name": "invoiceId",
              "description": "The unique identifier of the invoice."
            }
          ]
        }
      },
      {
        "path": "/users/{userId}/invoices/{invoiceId}/invoice_items/{invoiceItemId}",
        "definition": {
          "entityName": "InvoiceItem",
          "schema": {
            "$ref": "#/backend/entities/InvoiceItem"
          },
          "description": "Stores invoice items for a specific invoice. `userId` is the user's UID, `invoiceId` is the invoice's ID, and `invoiceItemId` is the item's ID.",
          "params": [
            {
              "name": "userId",
              "description": "The unique identifier of the user."
            },
            {
              "name": "invoiceId",
              "description": "The unique identifier of the invoice."
            },
            {
              "name": "invoiceItemId",
              "description": "The unique identifier of the invoice item."
            }
          ]
        }
      }
    ],
    "reasoning": "The Firestore structure is designed to support the SwiftBill application's data model, focusing on product categories, products, invoices, and invoice items. The design prioritizes simplicity and efficiency for GST billing, aligning with the application's core features. Path-based ownership is used where applicable.\n\nThe `productCategories` collection stores product categories, while the `products` collection stores products. Invoices and InvoiceItems are nested under user documents (`/users/{userId}`), which follows the principle of path-based ownership for user-specific data. Invoices are stored in a `invoices` subcollection and InvoiceItems are stored in a `invoice_items` subcollection. This design ensures that invoice data is segregated and easily manageable for each user.\n\nAuthorization Independence: No authorization data requires denormalization in this basic setup since there are no collaborative aspects. If user roles or shared invoices are introduced, a membership map (`members: {uid1: 'role', uid2: 'role'}`) would need to be denormalized into the relevant documents to avoid `get()` calls in security rules.\n\nQAPs (Rules are not Filters): The structure enables secure `list` operations because each collection contains homogeneous documents with similar security requirements. For example, listing products does not require filtering based on user-specific permissions.\n"
  }
}
